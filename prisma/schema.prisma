generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id         Int          @id @default(autoincrement())
  email      String       @unique @db.VarChar(100)
  password   String       @db.VarChar(100)
  nama       String       @db.VarChar(100)
  role       roleUser
  token      String?      @unique @db.VarChar(512)
  status     statusUser   @default(not_verified)
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  otp        String?      @unique @db.VarChar(100)
  otpExp     DateTime?
  laporan    Laporan[]
  peminjaman Peminjaman[]

  @@map("users")
}

model Book {
  id           Int          @id @default(autoincrement())
  judul        String       @db.VarChar(100)
  penulis      String       @db.VarChar(100)
  penerbit     String       @db.VarChar(100)
  tahun_terbit Int          @db.Year
  kategori     String       @db.VarChar(50)
  stok         Int
  isFeatured   Boolean      @default(false)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  peminjaman   Peminjaman[]

  @@map("books")
}

model Peminjaman {
  id              Int               @id @default(autoincrement())
  user_id         Int
  buku_id         Int
  tanggal_pinjam  DateTime
  tenggat_kembali DateTime
  valid           Boolean           @default(false)
  status          peminjaman_status @default(Diproses)
  buku            Book              @relation(fields: [buku_id], references: [id], onDelete: Cascade)
  user            User              @relation(fields: [user_id], references: [id], onDelete: Cascade)
  pengembalian    Pengembalian?

  @@index([buku_id], map: "peminjaman_buku_id_fkey")
  @@index([user_id], map: "peminjaman_user_id_fkey")
  @@map("peminjaman")
}

model Pengembalian {
  id                   Int                       @id @default(autoincrement())
  peminjaman_id        Int                       @unique
  tanggal_dikembalikan DateTime
  hari_telat           Int
  kondisi_buku         pengembalian_kondisi_buku
  denda                Decimal                   @db.Decimal(10, 2)
  peminjaman           Peminjaman                @relation(fields: [peminjaman_id], references: [id], onDelete: Cascade)

  @@map("pengembalian")
}

model Laporan {
  id                 Int      @id @default(autoincrement())
  periode            String   @db.VarChar(25)
  total_peminjaman   Int
  total_pengembalian Int
  dibuat_oleh        Int
  tanggal_laporan    DateTime
  user               User     @relation(fields: [dibuat_oleh], references: [id], onDelete: Cascade)

  @@index([dibuat_oleh], map: "laporan_dibuat_oleh_fkey")
  @@map("laporan")
}

enum roleUser {
  admin
  user
}

enum statusUser {
  verified
  not_verified
}

enum pengembalian_kondisi_buku {
  Baik
  Rusak
  Hilang
}

enum peminjaman_status {
  Diproses
  Dipinjam
  Dikembalikan
}
